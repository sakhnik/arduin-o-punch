# Користування Arduin-O-Punch

[![Зелеста](zelesta.jpg)](https://www.facebook.com/ZELESTAclub)

Система відмітки [Arduin-O-Punch](https://github.com/sakhnik/arduin-o-punch)
складається із таких частин:

* мобільний додаток на телефоні з андроїдом
* станції розміром 124 х 72 х 32 мм
* програматор для конфігурації станцій
* картки для відмітки.

Учасники проходять дистанцію із картками і ставлять відмітки на кожному
контрольному пункті, прикладаючи картку до станції.
Мобільний додаток дозволяє підготувати картки учасників на передстартовій
реєстрації та зчитати і надіслати результати після фінішу для обробки у програму
[QuickEvent](https://github.com/Quick-Event/quickbox).
Програматор потрібен для підготовки станцій до змагань: задання ключа шифрування
відмітки, синхронізації годинників, підготовки внутрішньої пам’яті станцій до
запису відміток, перевірки параметрів тощо.

Система змодельована за принципом SPORTIndent, проте є й суттєві відмінності.
Наприклад, не потрібна окрема станція для очищення відміток перед стартом.

## Технічні характеристики системи

| Параметр    |   Значення   |
|-------------|--------------|
| Робоча напруга схеми  |   3.3 В |
| Час роботи станції від повністю зарядженого акумулятора 3000 мА·г | ~7 днів |
| Роздільна здатність годинника  |  1 сек  |
| Точність годинника    |   3.5 ppm ~ 0.3 сек/день |
| Максимальна кількість відміток на картці | 176 |
| Максимальна кількість записів у станції  | 8000 (до 1 підходу)<br/>4000 (до 3 підходів)<br/>1000 (до 15 підходів) |

## Учасникам

Під час реєстрації видається стартовий номер, який буде використаний у картці
відмітки для ідентифікації. Організатори підготують і видадуть готову до
проходження дистанції картку під час мандатної комісії.

Для успішного проходження дистанції потрібно відмітитися на старті, потім на
всіх контрольних пунктах дистанції у заданому порядку (або й ні залежно від умов
змагань), нарешті на фініші.

Відмітка записується у картку шляхом піднесення до коробки станції до отримання
звукового і видимого підтвердження. Коротний і довгий сигнал «ті-таа», як у
літері А в азбуці Морзе. Якщо одночасно піднесуть свої картки кілька учасників,
станція поставить відмітку усім, оскільки це відбувається швидко. При цьому
звуковий сигнал свідчитиме про кількість відмічених карток. Наприклад,
«ті-ті-таа» для двох карток, «ті-ті-ті-таа» для трьох карток і так далі.
Якщо з якоїсь причини місця на картці для відмітки більше немає, станція
повідомить «ті-ті-таа-ті», як літера F в азбуці Морзе.

Результат зчитують після фінішу секретарі змагань з допомогою мобільного додатку
Android. Він автоматично вивантажується у програму QuickEvent для обробки і відразу
видається друкована квитанція. Відмітка продовжує зберігатися на картці до
наступного старту.

## Організаторам

### Підготовка станцій до змагань

### Розміщення станцій у контрольних пунктах

### Підготовка карток перед стартом

### Відновлення карток після змагань

дається стартовий номер і картка підготовлена для відмітки у картці буде
записано номер учасника і ключі
На дистанції учасники повинні підносити картку до кожної станції на контрольних пунктах для того щоб отримати відмітку при цьому буде звучати звуковий сигнал якщо одночасно підбігають кілька учасників станція поставити в мітку всі піднесені картки тому що це відбувається швидко при цьому звуковий сигнал буде говорити про кількість відмічених карток наприклад так так так якщо місця на картці для відмітки більше немає з якоїсь причини то станція буде звучати по-іншому як буква f в азбуці Морзе та-та-та
Окремої станції для очищення немає і це не потрібно оскільки вся попередня відмітка очищується на стартовому контрольному пункті
Підготовка до змагань до змагань організатор чи секретар повинні створити якийсь таємний ключ для того щоб убезпечити від несанкціонованої картки від несанкціонованої відмітки цей ключ потрібно буде використовувати на реєстрації для підготовки карток спортсменів і потрібно його використати для підготовки станцій до змагань для цього потрібно під'єднати програматор у програматорі є інтерфейс командного рядка серед найважливіших команд там команда k яка дозволяє задати ключ і це треба буде повторити з кожною станцією
Синхронізація часу для того щоб мати надійні результати потрібно щоб всі станції працювали синхронно тобто щоб годинники у станціях показували однаковий час і при створенні відмітки цей час був точним це не обов'язково впливає на загальний результат тому що якщо є один стартовий і один фінішний контрольний пункт з однією одна станція стартова станція одна фінішна станція і всі спортсмени пробігають від старту до фінішу ставлячи відмітки на старті фініші то у всіх будуть відносно відносні результати абсолютно правильні точний час на проміжних контрольних пунктах потрібен для правильнішого обчислення темпу руху між пунктами для синхронізації часу потрібно знову скористатися програматором для цього у початковому коді є скрипт synclock який потрібно запустити коли станція під'єднана до комп'ютера
При підготовці до змагань потрібно виконати такі дії перше переконатись що кожна станція має заряджений акумулятор для цього досить натиснути на кнопку біля акумулятора і подивитися рівень заряду по індикації або поміряти напругу на клемах акумулятора вона повинна бути десь близько 3,7 в що відповідає акумулятор зарядженому на половину друге потрібно синхронізувати час всі годинники йдуть по-різному тому за деякий час годинники почнуть показувати різний час для цього треба скористатися скриптом synclock при під'єднаному програматорові третє потрібно задати ключ який буде використовуватись на цих змаганнях ключ має бути таємний і однаковий на всіх станціях і у додатку android знову ж заходимо в програматором у команди меню і виконуємо команду k і задаємо ключ нистковий ключ третє потрібно перевірити правильність всіх налаштувань працездатність станції і можна від'єднати акумулятор безпосередньо до дня змаганьЧетверте потрібно оцінити очікувану кількість учасників і відформатувати внутрішню пам'ять станції для реєстрації зроблених відміток це може бути потрібно може знадобитися підсумку коли не спрацює відмітка у картці і спортсмен наполягатиме на тому що він був у цьому місці запис може залишитися у внутрішній пам'яті для цього у командному рядку ми виконуємо команду РЕК fmt вибираємо кількість вводимо кількість учасників очікувану кількість учасників пробіл і кількість бітів пам'яті які ми виділяємо на одну відмітку 1 біт це тільки інформація був він там чи ні хоч один або більше разів два біти для того щоб розрізнити не був жодного разу був один раз був двічі і був три або більше разів чотири біти для того щоб розрізнити до 15 відміток на одному контрольному пункті тобто якщо є метелик то в центральному контрольному пункті користувач може бігун може відмітитися до 15 разів і ми знатимемо скільки кількість бітів потрібно вибирати ощадливо тому що резерв внутрішньої пам'яті по кількості перезаписів обмежений
Перед постановкою дистанції потрібно переконатись що акумулятори заряджені що станції сконфігуровані були напередодні і під'єднати акумулятор переконатися що станція працює з допомогою відмітки в службовій картці після цього можна йти і ставити контрольний пункт на місцевості після закріплення станції обов'язково потрібно перевірити чи вона продовжує працювати з допомогою відмітки в картці
Національні частини станції відмітки на кожній станції відмітки є акумулятор із індикацією рівня заряду гніздо для заряджання акумулятора від micro USB гніздо для під'єднання програматора із можливістю надсилання команди і перевірки стану станції є годинник із батарейкою не перезаряджуваною cr2032 її заряду повинно вистачити на кілька років є зчитувач записувач карток класичних карток 1к мікроконтролер у мікроконтролері у внутрішній пам'яті є записано ключ шифрування який використовується на цих змаганнях номер станції також решта пам'яті виділена для запису історії відмітки записується тільки номер карток які і кількість відміток які вони здійснили на цій станції

